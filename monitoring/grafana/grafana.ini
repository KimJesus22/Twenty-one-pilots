# Twenty One Pilots - Grafana Configuration with RBAC
# Enhanced security configuration with role-based access control

[server]
http_port = 3000
domain = monitoring.yourdomain.com
root_url = https://monitoring.yourdomain.com

[security]
admin_user = admin
admin_password = ${GF_SECURITY_ADMIN_PASSWORD}
secret_key = ${GF_SECURITY_SECRET_KEY}
disable_gravatar = true
cookie_secure = true
cookie_samesite = strict

# RBAC Configuration
rbac_enabled = true

[auth]
disable_login_form = false
oauth_auto_login = false

[auth.basic]
enabled = true

[auth.proxy]
enabled = true
header_name = X-WEBAUTH-USER
header_property = username
auto_sign_up = false

[users]
allow_sign_up = false
auto_assign_org = true
auto_assign_org_role = Viewer

# RBAC Role definitions
[authorization]
enabled = true

# Custom roles for Twenty One Pilots
[[authorization.roles]]
name = "Twenty One Pilots Admin"
description = "Full access to all dashboards and administrative functions"
permissions = [
  "*:*:*"
]

[[authorization.roles]]
name = "Twenty One Pilots Deployer"
description = "Access to deployment and infrastructure monitoring"
permissions = [
  "dashboards:read",
  "folders:read",
  "datasources:read",
  "datasources:query",
  "org.users:read"
]

[[authorization.roles]]
name = "Twenty One Pilots Developer"
description = "Access to application metrics and logs"
permissions = [
  "dashboards:read",
  "folders:read",
  "datasources:query"
]

[[authorization.roles]]
name = "Twenty One Pilots Viewer"
description = "Read-only access to public dashboards"
permissions = [
  "dashboards:read",
  "folders:read"
]

[authorization.teamsync]
enabled = true

# LDAP/SSO Integration (optional)
[auth.ldap]
enabled = false
config_file = /etc/grafana/ldap.toml

# Database configuration
[database]
type = sqlite3
path = /var/lib/grafana/grafana.db

# Session configuration
[session]
provider = redis
provider_config = addr=redis:6379,pool_size=100,idle_timeout=10

# Logging configuration
[log]
level = info
format = json

[log.console]
level = info
format = json

# Alerting configuration
[alerting]
enabled = true
execute_alerts = true

# SMTP configuration for notifications
[smtp]
enabled = true
host = smtp.gmail.com:587
user = ${SMTP_USER}
password = ${SMTP_PASSWORD}
cert_file =
key_file =
skip_verify = false
from_address = alerts@yourdomain.com
from_name = Twenty One Pilots Monitoring

# External image storage (optional)
[external_image_storage]
provider = s3
bucket = twentyonepilots-monitoring
region = us-east-1
path = external-images

# Plugin configuration
[plugins]
allow_loading_unsigned_plugins = false

# Dashboard provisioning
[dashboards]
default_home_dashboard_path = /etc/grafana/provisioning/dashboards/home.json

# Data source provisioning
[datasources]
# Configured via provisioning files

# Alert manager configuration
[unified_alerting]
enabled = true
alertmanager_config = /etc/grafana/provisioning/alerting/alertmanager.yml

# Metrics configuration
[metrics]
enabled = true
interval_seconds = 10
basic_auth_username = ${GF_METRICS_USERNAME}
basic_auth_password = ${GF_METRICS_PASSWORD}

# Analytics (disabled for privacy)
[analytics]
reporting_enabled = false
check_for_updates = false

# Snapshots (disabled for security)
[snapshots]
external_enabled = false

# Live streaming (optional)
[live]
max_connections = 100
allowed_origins = ["https://yourdomain.com", "https://monitoring.yourdomain.com"]